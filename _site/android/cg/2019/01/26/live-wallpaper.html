<!doctype html>
<html lang="zh">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="msvalidate.01" content="D1B532AF972A1AB6C3525C904A9AC816" />
  <meta name="google-site-verification" content="-ujy_zWUIaX-QJ4vdUYfXThyZgr_KqsU0lL611rqsy8" />
  <title>安卓动态壁纸的实现！</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/app.js"></script>
</head>

  <body>
    <div id="contentPane" class="huge-page real main">
      <h1><a href="/">Frame of 42yeah</a></h1>
      <h2>安卓动态壁纸的实现！</h2>
      <hr />
      <section>
        <div style="margin-bottom: -25px">
  <div id='MicrosoftTranslatorWidget' class='Dark' style='color:white;background-color:inherit;height:30px;'></div>
</div>

<script type='text/javascript'>
  setTimeout(function(){
    {var s=document.createElement('script');s.type='text/javascript';s.charset='UTF-8';s.src=((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=ueOIGRSKkd965FeEGM5JtQ**&ctf=False&ui=true&settings=Manual&from=';var p=document.getElementsByTagName('head')[0]||document.documentElement;p.insertBefore(s,p.firstChild); }
  },0);
</script>
<script type='text/javascript' src='//www.bing.com/widget/bootstrap.js' data-id='cc2030a35e7345a1940e909993402b13' data-version='1.0b' data-autosnapshot='false' async></script>
        <p>我在很小很小的时候就对安卓的动态壁纸着迷。我一直都很想搞一个类似天空草地的动态壁纸：一片草地在蓝天下摇曳。到了晚上，则是繁星满天，甚是好看……</p>

<p>现在也到了我能看懂这些东西是怎么造出来的时候了，所以今天我就无名火起，突然想试试动态壁纸的实现（其实还有跟着的 GLES）。虽然很早很早之前就已经想试试了，但是今天我感觉刚刚学完车，时间也还多，大创暂时还可以先放半边（对面催我已经有点急了……）并且我真的真的很想在我的手机上显示出酷炫的特效，而且这个特效别人在应用商店上是找不到的。所以马上开工！</p>

<h2 id="开工">开工！</h2>

<p>安卓的动态壁纸是由 <a href="https://developer.android.com/reference/android/service/wallpaper/WallpaperService"><code class="highlighter-rouge">WallpaperService</code></a> 提供的。我们只要来一个继承了这个的 class ，就可以在我们自己的桌面上渲染出酷炫画面了。所以首先我们先改一下 <a href="https://developer.android.com/guide/topics/manifest/manifest-intro">AndroidManifest.xml</a>，增加一个服务:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;service</span> <span class="na">android:name=</span><span class="s">".Wallpaper"</span>
    <span class="na">android:label=</span><span class="s">"Wallpaper"</span>
    <span class="na">android:permission=</span><span class="s">"android.permission.BIND_WALLPAPER"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.service.wallpaper.WallpaperService"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>

    <span class="nt">&lt;meta-data</span>
        <span class="na">android:name=</span><span class="s">"android.service.wallpaper"</span>
        <span class="na">android:resource=</span><span class="s">"@xml/wallpaper_main"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></div></div>

<p>这几行是我在我的 Activity 底下加的。是底下，不是在里面。如果你建的是空项目，那我就是在 Application 里面加的。</p>

<p><code class="highlighter-rouge">android:name</code>, <code class="highlighter-rouge">android:label</code> 都是可以改的，我觉得这个名字比较通用而已。<code class="highlighter-rouge">meta-data</code> 里面的 <code class="highlighter-rouge">android:resource</code> 也是可以改的，你只要在你的 <code class="highlighter-rouge">xml</code> 文件夹底下创建相应的 xml 文件就可以了……但整体下来，这就是我要加的 service 的结构了:</p>

<ul>
  <li>首先我声明了一个 service (废话)</li>
  <li>然后他的名字叫 Wallpaper</li>
  <li>他对应的 class 也叫做 Wallpaper (android:name)</li>
  <li>它使用了权限 <code class="highlighter-rouge">android.permission.BIND_WALLPAPER</code></li>
  <li>他会加入到安卓的 WallpaperService 里边 (也就是可以在动态壁纸里头可以被找到)</li>
  <li>他的元数据，也就是动态壁纸的元数据，储存在 <code class="highlighter-rouge">xml/wallpaper_main.xml</code> 内</li>
</ul>

<p>接下来，我们前往 res/xml 文件夹 (没有就创建)，然后创建一个名字叫 wallpaper_main.xml 的文件（或者你自己爱叫什么叫什么，保持跟 <code class="highlighter-rouge">android:resource</code> 一样就可以了），然后填入:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;wallpaper</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:thumbnail=</span><span class="s">"@drawable/ic_launcher_background"</span>
    <span class="na">android:description=</span><span class="s">"@string/description"</span>
    <span class="na">android:settingsActivity=</span><span class="s">"org.whatever.wallpaper.SettingsActivity"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>其中:</p>

<ul>
  <li><code class="highlighter-rouge">android:thumbnail</code> 是你壁纸的预览图，在动态壁纸选择那里可以看得到</li>
  <li><code class="highlighter-rouge">android:descrption</code> 就是你壁纸的介绍了……很抱歉我又说了废话……</li>
  <li><code class="highlighter-rouge">android:settingsActivity</code> 就是你记得选择动态壁纸那里右上角会有一个小齿轮，让你可以设置你自己的动态壁纸的吗？没错这就是用户按了那个齿轮之后进入的 Activity 。记得自己改！当然压根没有这个 Activity 也是一样能过 build 的…… 只不过用户按那个齿轮的时候会停止运行而已。</li>
</ul>

<p><strong>Very good!</strong> 接下来，我们就可以新建一个 Wallpaper.java (因为 android:name! 再说一次可以自己改！) ，然后让他继承一下 <code class="highlighter-rouge">WallpaperService</code>!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">whatever</span><span class="o">.</span><span class="na">wallpaper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.service.wallpaper.WallpaperService</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Wallpaper</span> <span class="kd">extends</span> <span class="n">WallpaperService</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Engine</span> <span class="nf">onCreateEngine</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>这就是结果了。很明显，<code class="highlighter-rouge">WallpaperService</code> 要你实现的东西很简单，就是一个 <code class="highlighter-rouge">onCreateEngine</code> 。那他要你返回的是一个什么呢？聪明！就是一个 <a href="https://developer.android.com/reference/android/service/wallpaper/WallpaperService.Engine"><code class="highlighter-rouge">Engine</code></a> 。我们可以改改上面那行 <code class="highlighter-rouge">return null</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">return</span> <span class="k">new</span> <span class="n">Engine</span><span class="o">();</span>
</code></pre></div></div>

<p>实际上，此时我们的动态壁纸已经完全可以用了。问题在于，他虽然可以用，但他完全没用……因为我们什么都没有实现，所以我们的动态壁纸将会永远是一个黑屏。<sub>啊，图形学！</sub>因此，为了让我们更进一步，在这个动态壁纸上面作画，我们需要继承自己的 WallpaperService.Engine。但是！在实现之前，要注意！<strong>我们继承的 Engine 必须要在我们继承的 WallpaperService 里头:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">whatever</span><span class="o">.</span><span class="na">wallpaper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.service.wallpaper.WallpaperService</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Wallpaper</span> <span class="kd">extends</span> <span class="n">WallpaperService</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Engine</span> <span class="nf">onCreateEngine</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">WallpaperEngine</span><span class="o">();</span>
    <span class="o">}</span>



    <span class="kd">class</span> <span class="nc">WallpaperEngine</span> <span class="kd">extends</span> <span class="n">Engine</span> <span class="o">{</span>

    <span class="o">}</span>

<span class="o">}</span>


</code></pre></div></div>

<p>这就是最不舒服的时候了……因为如果你在用一个 IDE 的话<sub>你肯定在用吧</sub>，他什么都不会叫你实现……但是没关系！实际上，我们可以 <code class="highlighter-rouge">override</code> 一些方法来达到我们想要的效果。我们首当其冲应该 <code class="highlighter-rouge">override</code> <code class="highlighter-rouge">onCreate</code> ，因为这个函数会在 Engine 被初始化时调用:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">surfaceHolder</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>接下来，我们就发现，诶哟，那不是 <a href="https://developer.android.com/reference/android/view/SurfaceHolder"><code class="highlighter-rouge">SurfaceHolder</code></a> 吗？这种东西不是拿着一个 <a href="https://developer.android.com/reference/android/view/Surface"><code class="highlighter-rouge">Surface</code></a> 的吗？！也就是说，按照一般套路，我只要这样:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">surfaceHolder</span><span class="o">);</span>

    <span class="n">Surface</span> <span class="n">surface</span> <span class="o">=</span> <span class="n">surfaceHolder</span><span class="o">.</span><span class="na">getSurface</span><span class="o">();</span>
    <span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="na">lockCanvas</span><span class="o">();</span>

    <span class="c1">// 或者直接 </span>
    <span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">surfaceHolder</span><span class="o">.</span><span class="na">lockCanvas</span><span class="o">();</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>岂不美哉？！</p>

<h2 id="很可惜">很可惜……</h2>

<p>很可惜，不行……因为在 <code class="highlighter-rouge">Engine</code> 初创的时候， Surface 根本就还没准备好！于是，我们别无他法，只好给他加上 callback:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SurfaceHolder</span><span class="o">.</span><span class="na">Callback</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SurfaceHolder</span><span class="o">.</span><span class="na">Callback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Surface 准备好啦！</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Surface 大小变了……或者是 Surface 失去了焦点（譬如用户打开了个程序！）</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Surface 毁了……</span>
    <span class="o">}</span>
<span class="o">};</span>


<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">surfaceHolder</span><span class="o">);</span>

    <span class="n">surfaceHolder</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>然后接下来，你就可以在 <code class="highlighter-rouge">surfaceCreated</code> 被 call 了之后，开一条线程，然后愉快的画画了！但是，</p>

<h2 id="发现并没有那么简单">发现并没有那么简单……</h2>

<p>但是我还想要在 Surface 上绘制 OpenGL 内容……我不想要辣鸡 Canvas! 抱着这样的想法，我上网一搜，什么都没搜到……我只好看项目代码 + 查文档，搞了半天才终于让他可以运作……所以我要把过程放出来！也好避免我以后自己少走弯路……</p>

<p>我们都知道，OpenGL 要绘制，必须得有 Context 。<a href="https://developer.android.com/reference/android/opengl/GLSurfaceView">GLSurfaceView 的硬直+方便我们是知道的</a> ，一个 <a href="https://developer.android.com/reference/android/opengl/GLSurfaceView.Renderer"><code class="highlighter-rouge">Renderer</code></a> 就足够了。但是这里不一样，因为我们没有 GLSurfaceView 。我们也创建不了，因为这是 Service ，不是 Activity 。所以怎么办呢？我们就只能用土办法了……</p>

<p><strong>接下来的动作都在 onCreate 内完成，并且，因为怕有些手机还没有 GLES3 ，所以我用 GLES2</strong></p>

<p>来！记住我们的步骤！</p>

<ul>
  <li>
    <p>创建 <a href="https://developer.android.com/reference/android/opengl/EGLDisplay"><code class="highlighter-rouge">EGLDisplay</code></a>！</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">EGLDisplay</span> <span class="n">display</span> <span class="o">=</span> <span class="n">EGL14</span><span class="o">.</span><span class="na">eglGetDisplay</span><span class="o">(</span><span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_DEFAULT_DISPLAY</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>初始化 <a href="https://developer.android.com/reference/android/opengl/EGLConfig"><code class="highlighter-rouge">EGLConfig</code></a>!</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">EGLConfig</span><span class="o">[]</span> <span class="n">configs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EGLConfig</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
  <span class="kt">int</span><span class="o">[]</span> <span class="n">numConfigs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
  <span class="kt">int</span><span class="o">[]</span> <span class="n">configAttrs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_RED_SIZE</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_GREEN_SIZE</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_BLUE_SIZE</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_DEPTH_SIZE</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_STENCIL_SIZE</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_RENDERABLE_TYPE</span><span class="o">,</span> <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_OPENGL_ES2_BIT</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_NONE</span>
  <span class="o">};</span>

  <span class="n">EGL14</span><span class="o">.</span><span class="na">eglChooseConfig</span><span class="o">(</span><span class="n">display</span><span class="o">,</span> <span class="n">configAttrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">configs</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">configs</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">numConfigs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>

  <span class="n">EGLConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="n">configs</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
</code></pre></div>    </div>

    <p>在这里我们可以看到很浓重的 NDK 的身影。一个个的数组就像是强行的指针，一点都不幸福……</p>

    <p>我们可以看到 configAttrs 那里就像是一个字符串，以 属性/值 属性/值 这样的方法来按顺序排列，最后以 <code class="highlighter-rouge">EGL_NONE</code> 收尾……</p>
  </li>
  <li>
    <p>初始化 <a href="https://developer.android.com/reference/android/opengl/EGLContext"><code class="highlighter-rouge">EGLContext</code></a>!</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kt">int</span><span class="o">[]</span> <span class="n">contextAttrs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_CONTEXT_CLIENT_VERSION</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_NONE</span>
  <span class="o">};</span>

  <span class="n">context</span> <span class="o">=</span> <span class="n">EGL14</span><span class="o">.</span><span class="na">eglCreateContext</span><span class="o">(</span><span class="n">display</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_NO_CONTEXT</span><span class="o">,</span> <span class="n">contextAttrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</code></pre></div>    </div>

    <p>可以看到，我在用的版本是 GLES2 ，跟我上面的加粗字体遥相呼应。小声逼逼一句，<a href="https://en.wikipedia.org/wiki/OpenGL_ES#OpenGL_ES_3.0">GLES3</a> 好像没太普及开来？</p>
  </li>
  <li>
    <p>初始化 <a href="https://developer.android.com/reference/android/opengl/EGLSurface"><code class="highlighter-rouge">EGLSurface</code></a>!</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kt">int</span><span class="o">[]</span> <span class="n">surfaceAttrs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span>
          <span class="n">EGL14</span><span class="o">.</span><span class="na">EGL_NONE</span>
  <span class="o">};</span>

  <span class="n">surface</span> <span class="o">=</span> <span class="n">EGL14</span><span class="o">.</span><span class="na">eglCreateWindowSurface</span><span class="o">(</span><span class="n">display</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="n">surfaceHolder</span><span class="o">.</span><span class="na">getSurface</span><span class="o">(),</span> <span class="n">surfaceAttrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</code></pre></div>    </div>

    <p>EGL 普遍采用这种 attr 的记录样式……</p>
  </li>
  <li>
    <p>最后！经典的 <code class="highlighter-rouge">makeContextCurrent</code>!</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">EGL14</span><span class="o">.</span><span class="na">eglMakeCurrent</span><span class="o">(</span><span class="n">display</span><span class="o">,</span> <span class="n">surface</span><span class="o">,</span> <span class="n">surface</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>就是这样！我们终于把 Surface 中的 OpenGL context 给<del>压榨</del>创建出来了！为了验证，只需要进行简单的清一下屏:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GLES20</span><span class="o">.</span><span class="na">glClearColor</span><span class="o">(</span><span class="mf">0.9f</span><span class="o">,</span> <span class="mf">0.8f</span><span class="o">,</span> <span class="mf">0.7f</span><span class="o">,</span> <span class="mf">1.0f</span><span class="o">);</span>
<span class="n">GLES20</span><span class="o">.</span><span class="na">glClear</span><span class="o">(</span><span class="n">GLES20</span><span class="o">.</span><span class="na">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GLES20</span><span class="o">.</span><span class="na">GL_DEPTH_BUFFER_BIT</span><span class="o">);</span>

<span class="n">EGL14</span><span class="o">.</span><span class="na">eglSwapBuffers</span><span class="o">(</span><span class="n">display</span><span class="o">,</span> <span class="n">surface</span><span class="o">);</span> <span class="c1">// 别忘了！</span>
</code></pre></div></div>

<p>然后编译+运行，然后选择壁纸！你就可以发现原本黑乎乎的，现在已经变成美妙的肉色了！</p>

<p><img src="/assets/meat.png" alt="肉肉的" /></p>

<h2 id="搞定">搞定！</h2>

<p>接下来，怎么处置这个东西，就看你了！</p>

      </section>
      <h2 id="评论区">评论区</h2>
<div id="disqus_thread" style="font-size: 12px !important;"></div>
<script>
  var disqus_config = function () {
    this.page.url = "https://potion4.github.io/android/cg/2019/01/26/live-wallpaper.html";
    this.page.identifier = "安卓动态壁纸的实现！";
  };

  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://frame-of-42yeah.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html>
