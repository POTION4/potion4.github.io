<!doctype html>
<html lang="zh">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="msvalidate.01" content="D1B532AF972A1AB6C3525C904A9AC816" />
  <meta name="google-site-verification" content="-ujy_zWUIaX-QJ4vdUYfXThyZgr_KqsU0lL611rqsy8" />
  <title>你好，WebAssembly!</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/app.js"></script>
</head>

  <body>
    <div id="contentPane" class="huge-page real main">
      <h1><a href="/">Frame of 42yeah</a></h1>
      <h2>你好，WebAssembly!</h2>
      <hr />
      <section>
        <div style="margin-bottom: -25px">
  <div id='MicrosoftTranslatorWidget' class='Dark' style='color:white;background-color:inherit;height:30px;'></div>
</div>

<script type='text/javascript'>
  setTimeout(function(){
    {var s=document.createElement('script');s.type='text/javascript';s.charset='UTF-8';s.src=((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=ueOIGRSKkd965FeEGM5JtQ**&ctf=False&ui=true&settings=Manual&from=';var p=document.getElementsByTagName('head')[0]||document.documentElement;p.insertBefore(s,p.firstChild); }
  },0);
</script>
<script type='text/javascript' src='//www.bing.com/widget/bootstrap.js' data-id='cc2030a35e7345a1940e909993402b13' data-version='1.0b' data-autosnapshot='false' async></script>
        <p>WebAssembly 是一个很强大的东西，具体可以参照 <a href="https://webassembly.org">WebAssembly.org</a> 给出的说明：</p>

<blockquote>
  <p>WebAssembly (缩写 Wasm) 是一个二进制的，给一个基于堆栈的虚拟机的，指令格式。Wasm 设计出来是为了成为一个高端语言（C/C++/Rust) 的可移植性目标，并且开放这些语言在客户端网页或者服务端程序上的部署。</p>
</blockquote>

<h2 id="准备">准备</h2>

<p>WebAssembly 最常用的编译器好像就是 <a href="https://emscripten.org">EMScripten</a> 。这个东西可以把 C/C++ 直接翻译成 Wasm ，然后放在浏览器上跑。因此，如果你准备开搞，你需要先去<a href="http://kripken.github.io/emscripten-site/docs/getting_started/downloads.html">这里</a> 下载一份 emsdk。如果把那边的英文翻译过来，是这样的：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 拿到 emsdk 的库</span>
git clone https://github.com/juj/emsdk.git

<span class="c"># 进入那个目录</span>
<span class="nb">cd </span>emsdk

<span class="c"># 抓取最新版本</span>
./emsdk <span class="nb">install </span>latest

<span class="c"># 启用最新版本</span>
./emsdk activate latest

<span class="c"># 改一下环境变量</span>
<span class="nb">source</span> ./emsdk_env.sh
</code></pre></div></div>

<p><strong>注意，如果你是 Windows 的话，把 <code class="highlighter-rouge">./emsdk</code> 换成 <code class="highlighter-rouge">emsdk</code> ，把 <code class="highlighter-rouge">source ./emsdk_env.sh</code> 换成 <code class="highlighter-rouge">emsdk_env.bat</code> 就行了。搞定完之后，他大！你现在可以在 <code class="highlighter-rouge">cmd</code> 上跑 <code class="highlighter-rouge">emcc</code>/<code class="highlighter-rouge">em++</code> 了！！</strong></p>

<h2 id="你好世界">你好世界！</h2>

<p>实际上，要写一份远要比想象中的简单。在这里要先特殊说明一下，因为 WebAssembly 好像还不支持本地的 <code class="highlighter-rouge">file://</code> 协议。所以，我提议你在本地开一个服务器，并且服务器要就要可以 reload 的。我会推荐这个：</p>

<p><code class="highlighter-rouge">yarn global add simple-autoreload-server</code></p>

<p>或者</p>

<p><code class="highlighter-rouge">npm install -g simple-autoreload-server</code></p>

<p>跟 <code class="highlighter-rouge">http-server</code> 不同的是，这个会不断的自动重新加载。由于你的浏览器会为了省流量而进行缓存，而你在开发的阶段网页啊，wasm啊什么的变化都会很大，所以我推荐可以自动重新加载的服务器。在你喜欢的地方新建一个空目录，然后运行：</p>

<p><code class="highlighter-rouge">autoreload-server .</code></p>

<p>就可以了。</p>

<p>到目前为止，你装上了 emsdk，可能还装上或者没装上我推荐的一个网页服务器。都没关系，因为我本来也不是很熟悉这些（港真，熟悉还写博客干嘛？）。但是接下来，进入这个文件夹，新建一个文件，你就可以开始尝试写一个自己的 hello world 了：</p>

<h3 id="mainc">main.c</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Hello world, wasm!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>名字叫什么都行，你自己喜欢。写好了之后，你就可以编译他了：</p>

<p><code class="highlighter-rouge">emcc -s WASM=1 -o main.html main.c</code></p>

<p>这里的 <code class="highlighter-rouge">WASM=1</code> 这个设置是在让 emcc 编译出 wasm 来。如果你设置成 <code class="highlighter-rouge">WASM=0</code>，那么就会编译成纯 Javascript。好像不加也行。但是总之！！编译好了之后，你就可以直接打开 <a href="http://127.0.0.1:8080/main.html">这个</a> 然后看到你的成果了！！（如果你一直什么都跟着我做的话！）</p>

<p><small>然后。。就写这么多了？感觉我还是不大会写博客啊。。。</small></p>

      </section>
      <h2 id="评论区">评论区</h2>
<div id="disqus_thread" style="font-size: 12px !important;"></div>
<script>
  var disqus_config = function () {
    this.page.url = "https://potion4.github.io/webassembly/2019/01/07/wasm-hello.html";
    this.page.identifier = "你好，WebAssembly!";
  };

  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://frame-of-42yeah.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html>
