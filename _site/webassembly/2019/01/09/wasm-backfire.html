<!doctype html>
<html lang="zh">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="msvalidate.01" content="D1B532AF972A1AB6C3525C904A9AC816" />
  <meta name="google-site-verification" content="-ujy_zWUIaX-QJ4vdUYfXThyZgr_KqsU0lL611rqsy8" />
  <title>WebAssembly åç€ç”¨å› Javascript</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/app.js"></script>
</head>

  <body>
    <div id="contentPane" class="huge-page real main">
      <h1><a href="/">Frame of 42yeah</a></h1>
      <h2>WebAssembly åç€ç”¨å› Javascript</h2>
      <hr />
      <section>
        <div style="margin-bottom: -25px">
  <div id='MicrosoftTranslatorWidget' class='Dark' style='color:white;background-color:inherit;height:30px;'></div>
</div>

<script type='text/javascript'>
  setTimeout(function(){
    {var s=document.createElement('script');s.type='text/javascript';s.charset='UTF-8';s.src=((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=ueOIGRSKkd965FeEGM5JtQ**&ctf=False&ui=true&settings=Manual&from=';var p=document.getElementsByTagName('head')[0]||document.documentElement;p.insertBefore(s,p.firstChild); }
  },0);
</script>
<script type='text/javascript' src='//www.bing.com/widget/bootstrap.js' data-id='cc2030a35e7345a1940e909993402b13' data-version='1.0b' data-autosnapshot='false' async></script>
        <p>å‰ä¸¤å¤©æˆ‘ä»¬è®²äº†ä¸€ä¸‹å„ç§ Wasm çš„åŸºæœ¬æ“ä½œï¼Œä»¥åŠ Javascript ä¸­æ€ä¹ˆæ ·æ–¹ä¾¿çš„è°ƒç”¨ wasm ä¸­å­˜åœ¨çš„å‡½æ•°ã€‚é‚£ä¹ˆä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œåœ¨ C/C++ ä¸­æœ‰æ²¡æœ‰å¯èƒ½å¯ä»¥è°ƒç”¨ Javascript å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼š</p>

<h2 id="em_js"><code class="highlighter-rouge">EM_JS</code></h2>
<p>ç›´æ¥åœ¨ C/C++ çš„æºç ä¸­åŠ å…¥ <code class="highlighter-rouge">EM_JS</code> å¯ä»¥åœ¨ C/C++ ä¸­ç›´æ¥ç”³æ˜ä¸€ä¸ªç”¨ Javascript å†™çš„å‡½æ•°ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EM_JS</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">alerts</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span>
    <span class="n">alert</span><span class="p">(</span><span class="s">"hai"</span><span class="p">)</span>
    <span class="n">alert</span><span class="p">(</span><span class="s">"bai"</span><span class="p">)</span>
<span class="p">});</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">alerts</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸Šä¾‹ä¸­ <code class="highlighter-rouge">EM_JS</code> å°±æ˜¯åœ¨ç”³æ˜ä¸€ä¸ª Javascript çš„å‡½æ•°ï¼š<code class="highlighter-rouge">function alerts() { ... }</code> ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿”å›å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å‚æ•°åˆ—è¡¨ï¼Œç¬¬å››ä¸ªå‚æ•°å°±æ˜¯ç”¨ Javascript å†™çš„å‡½æ•°çš„å®ç°éƒ¨åˆ†äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨ C/C++ ä¸­è°ƒç”¨ Javascript é‡Œçš„ä¸œè¥¿å¯è°“æ˜¯è¶…çº§æ–¹ä¾¿ï¼Œå¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ªå¤–éƒ¨åº“ä¹‹ç±»çš„ã€‚</p>

<p>ä½ è¿˜å¯ä»¥å‚è€ƒå¤šä¸€ä¸ªä¾‹å­ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EM_JS</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">sum</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">});</span>
</code></pre></div></div>

<p>è¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯æ±‚å’Œäº†ã€‚</p>

<h2 id="em_asm"><code class="highlighter-rouge">EM_ASM</code></h2>
<p>æœ‰çš„æ—¶å€™ï¼Œå¯èƒ½å› ä¸ºå¿ƒæ€ç‚¸äº†ï¼Œæˆ–è€…æ˜¯è´¼æ‡’ï¼Œä½ å‹æ ¹å°±ä¸æƒ³å£°æ˜ä¸€ä¸ªå‡½æ•°ç„¶åå†è°ƒç”¨ä»–ã€‚è¿™ä¹ˆçƒ¦å¹²å˜›å‘¢ï¼Ÿå¾ˆå¹¸è¿ï¼Œæˆ‘ä»¬è¿˜æœ‰ <code class="highlighter-rouge">EM_ASM</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"hello world in C/C++!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">EM_ASM</span><span class="p">({</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">UTF8ToString</span><span class="p">(</span><span class="err">$</span><span class="mi">0</span><span class="p">))</span>
    <span class="p">},</span> <span class="s">"hello world in javascript and the argument is even passed from C/C++!"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸éš¾çœ‹å‡ºï¼Œ<code class="highlighter-rouge">EM_ASM</code> åœ¨å†™å®Œè¦æ‰§è¡Œçš„é‚£æ®µä»£ç ä¹‹åï¼Œåé¢æ˜¯å¯ä»¥è·Ÿæ— é™ä¸ªå‚æ•°çš„ã€‚è€Œæ‰§è¡Œçš„é‚£ä¸€æ®µæ˜¯å¯ä»¥çœ‹åˆ°è¿™äº›å‚æ•°çš„ï¼Œä» $0 å¼€å§‹ï¼Œç„¶åæ˜¯ $1, $2, â€¦ è‡ªå·±ç”¨ç±»æ¯”æ¨ç†æ³•å§ã€‚ã€‚ã€‚</p>

<p>æ€»è€Œè¨€ä¹‹ï¼Œ<code class="highlighter-rouge">EM_ASM</code> å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥è¾¾æˆ C/C++/Javascript <del>æ»¥äº¤</del>æ··äº¤ã€‚é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ æ—¢å¯ä»¥æœ‰çš„æ—¶å€™ C/C++ï¼Œä¹Ÿå¯ä»¥æœ‰çš„æ—¶å€™ Javascript ï¼Œä¹Ÿå¯ä»¥åœ¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript ä¸­è°ƒç”¨ C ä¸­è°ƒç”¨ Javascript äº†ï¼ï¼ï¼</p>

<h2 id="emscripten_run_script"><code class="highlighter-rouge">emscripten_run_script</code></h2>
<p>å¿˜è®°äº†è¿˜æœ‰ä¸€ç§æ–¹æ³•äº†ã€‚ã€‚ã€‚å°±æ˜¯è¿™ä¸ªï¼Œ<code class="highlighter-rouge">emscripten_run_script</code>ã€‚è¿™ä¸ªå‡ ä¹æ˜¯ä¸€ä¸ªå®Œå…¨æœ¬åœŸåŒ–çš„ C å‡½æ•°äº†ï¼Œä»–æ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ª char * ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥è¿™æ ·ç”¨ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">emscripten_run_script</span><span class="p">(</span><span class="s">"console.log('hello world')"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åŠ¨æ€çš„æ‰§è¡Œ javascript ä»£ç ï¼Œå› ä¸ºæ˜¯ç›´æ¥è°ƒç”¨ js ä¸­çš„ eval() æ–¹æ³•çš„ã€‚ä½†æ˜¯æ³¨æ„ï¼Œå¦‚æœä½ ç¼–è¯‘çš„æ—¶å€™å¢åŠ äº†å‚æ•° <code class="highlighter-rouge">-s DYNAMIC_EXECUTION=0</code> ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†ä¼šä¸å¯ç”¨ğŸš«ğŸ™…ğŸˆ²ï¸ã€‚ï¼ˆè¯è¯´ä¸å¯ç”¨çš„ emoji å¯çœŸå¤šã€‚ã€‚ã€‚ï¼‰</p>

<h1 id="æèµ·å…´è¶£">æèµ·å…´è¶£ï¼ï¼ï¼</h1>
<p>ç»è¿‡äº†è¿ç»­ä¸‰å¤©çš„ Wasm æ—¥å¿—ï¼æˆ‘å†³å®šç”¨æˆ‘è‡ªå·±å†™çš„ä¸€äº›å°ä¸œè¥¿æ¥æèµ·ä¸€ä¸‹å¤§å®¶çš„å…´è¶£ï¼ˆé‡Œé¢æ ¸å¿ƒåŠŸèƒ½éƒ½ç”± C/C++ å®ç°ï¼ï¼‰ã€‚ã€‚</p>

<h2 id="æ–æ³¢æ‹‰å¥‘æ•°åˆ—">æ–æ³¢æ‹‰å¥‘æ•°åˆ—</h2>
<p><a href="javascript:oneMore()">ç®—å¤šä¸€ä¸ª</a></p>
<p id="fibonacci"></p>

<h2 id="æ—‹è½¬çš„æ–¹å—">æ—‹è½¬çš„æ–¹å—</h2>
<div id="picture" style="width: 100px; height: 100px; background-color: orange; margin-left: 1em;">
    &nbsp;
</div>

<h2 id="å­—ç¬¦ä¸²--äºŒè¿›åˆ¶ç ">å­—ç¬¦ä¸² =&gt; äºŒè¿›åˆ¶ç </h2>
<p><input id="input" />
<a href="javascript:accepted()">è½¬æ¢</a></p>
<p id="output"></p>

<hr />
<p>ä½ éšæ—¶å¯ä»¥è¿›å…¥æ£€ç´¢æ¥çœ‹çœ‹æˆ‘å®ç°çš„æ–¹æ³•ã€‚</p>

<h1 id="ç©å¾—å¼€å¿ƒ"><em>ç©å¾—å¼€å¿ƒï¼</em></h1>

<script>
    let picture = document.getElementById("picture")
    let output = document.getElementById("output")
    let fibonacci = document.getElementById("fibonacci")
    let input = document.getElementById("input")
    let frame, binarify, fib;

    function onRuntimeInitialized() {
        function animation() {
            requestAnimationFrame(animation)
            frame()
        }
        animation()
    }


    function oneMore() {
        fibonacci.innerHTML = fib()
    }


    function accepted() {
        binarify(input.value)
    }


    var Module = {
        print: function(text) {
            output.innerHTML += "<br />" + text
        },

        onRuntimeInitialized: function() {
            frame = Module.cwrap("frame", "void", [])
            binarify = Module.cwrap("binarify", "void", [ "string" ])
            fib = Module.cwrap("fib", "string", [])

            onRuntimeInitialized()
        },
    }
</script>

<script src="/assets/jff.js"></script>


      </section>
      <h2 id="è¯„è®ºåŒº">è¯„è®ºåŒº</h2>
<div id="disqus_thread" style="font-size: 12px !important;"></div>
<script>
  var disqus_config = function () {
    this.page.url = "https://potion4.github.io/webassembly/2019/01/09/wasm-backfire.html";
    this.page.identifier = "WebAssembly åç€ç”¨å› Javascript";
  };

  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://frame-of-42yeah.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html>
